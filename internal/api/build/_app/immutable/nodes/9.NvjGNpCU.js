import"../chunks/CWj6FrbW.js";import{Y as xt,aJ as kt,aK as St,F as Lt,W as $t,H as qt,X as Et,K as De,N as It,M as Nt,aa as Ye,G as Tt,aL as At,aM as Ft,k as Ot,d as Xe,aN as Ct,aO as Mt,aP as Pt,aQ as Rt,q as Dt,I as oe,af as He,ag as Je,ah as Yt,p as Ht,a1 as B,w as re,u as Jt,at as de,o as Ut,a as Bt,a5 as w,a2 as Y,g as e,a3 as f,x as s,a4 as n,f as Ie}from"../chunks/EFB-SWyS.js";import{b as Vt,w as Kt,d as jt,s as $}from"../chunks/TklIISlb.js";import{i as z}from"../chunks/BvnGME_Q.js";import{c as zt,g as Gt,e as ge,i as me,r as pe,s as ie}from"../chunks/CZfOvoJW.js";import{t as O,a as T,c as Wt}from"../chunks/B0_bw6gU.js";import{B as Qt,s as Ue,p as Xt}from"../chunks/D-TofhTc.js";import{b as ye}from"../chunks/C-J09gDs.js";import{b as Be}from"../chunks/P3fwdHIM.js";import{b as Zt}from"../chunks/BDUMxpH1.js";import{a as Ve,s as ea}from"../chunks/CG3NMINE.js";import{a as Ke,u as ta}from"../chunks/LjJPEWw8.js";import{h as je}from"../chunks/C5S46NFB.js";import{L as aa}from"../chunks/Clak3x_s.js";function ra(a,t,i){De&&It();var g=a,m=Et,r,h=xt()?kt:St;Lt(()=>{h(m,m=t())&&(r&&$t(r),r=qt(()=>i(g)))}),De&&(g=Nt)}const sa=()=>performance.now(),ee={tick:a=>requestAnimationFrame(a),now:()=>sa(),tasks:new Set};function Ze(){const a=ee.now();ee.tasks.forEach(t=>{t.c(a)||(ee.tasks.delete(t),t.f())}),ee.tasks.size!==0&&ee.tick(Ze)}function la(a){let t;return ee.tasks.size===0&&ee.tick(Ze),{promise:new Promise(i=>{ee.tasks.add(t={c:a,f:i})}),abort(){ee.tasks.delete(t)}}}function he(a,t){Kt(()=>{a.dispatchEvent(new CustomEvent(t))})}function oa(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const t=a.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function ze(a){const t={},i=a.split(";");for(const g of i){const[m,r]=g.split(":");if(!m||r===void 0)break;const h=oa(m.trim());t[h]=r.trim()}return t}const ia=a=>a;function Ge(a,t,i,g){var m=(a&Mt)!==0,r=(a&Pt)!==0,h=m&&r,p=(a&Ct)!==0,H=h?"both":m?"in":"out",q,E=t.inert,M=t.style.overflow,k,_;function C(){var b=Yt,V=Ye;He(null),Je(null);try{return q??(q=i()(t,(g==null?void 0:g())??{},{direction:H}))}finally{He(b),Je(V)}}var S={is_global:p,in(){var b;if(t.inert=E,!m){_==null||_.abort(),(b=_==null?void 0:_.reset)==null||b.call(_);return}r||k==null||k.abort(),he(t,"introstart"),k=Ne(t,C(),_,1,()=>{he(t,"introend"),k==null||k.abort(),k=q=void 0,t.style.overflow=M})},out(b){if(!r){b==null||b(),q=void 0;return}t.inert=!0,he(t,"outrostart"),_=Ne(t,C(),k,0,()=>{he(t,"outroend"),b==null||b()})},stop:()=>{k==null||k.abort(),_==null||_.abort()}},A=Ye;if((A.transitions??(A.transitions=[])).push(S),m&&Vt){var G=p;if(!G){for(var P=A.parent;P&&(P.f&Tt)!==0;)for(;(P=P.parent)&&(P.f&At)===0;);G=!P||(P.f&Ft)!==0}G&&Ot(()=>{Xe(()=>S.in())})}}function Ne(a,t,i,g,m){var r=g===1;if(Rt(t)){var h,p=!1;return Dt(()=>{if(!p){var A=t({direction:r?"in":"out"});h=Ne(a,A,i,g,m)}}),{abort:()=>{p=!0,h==null||h.abort()},deactivate:()=>h.deactivate(),reset:()=>h.reset(),t:()=>h.t()}}if(i==null||i.deactivate(),!(t!=null&&t.duration))return m(),{abort:oe,deactivate:oe,reset:oe,t:()=>g};const{delay:H=0,css:q,tick:E,easing:M=ia}=t;var k=[];if(r&&i===void 0&&(E&&E(0,1),q)){var _=ze(q(0,1));k.push(_,_)}var C=()=>1-g,S=a.animate(k,{duration:H});return S.onfinish=()=>{var A=(i==null?void 0:i.t())??1-g;i==null||i.abort();var G=g-A,P=t.duration*Math.abs(G),b=[];if(P>0){var V=!1;if(q)for(var X=Math.ceil(P/16.666666666666668),W=0;W<=X;W+=1){var K=A+G*M(W/X),Z=ze(q(K,1-K));b.push(Z),V||(V=Z.overflow==="hidden")}V&&(a.style.overflow="hidden"),C=()=>{var Q=S.currentTime;return A+G*M(Q/P)},E&&la(()=>{if(S.playState!=="running")return!1;var Q=C();return E(Q,1-Q),!0})}S=a.animate(b,{duration:P,fill:"forwards"}),S.onfinish=()=>{C=()=>g,E==null||E(g,1-g),m()}},{abort:()=>{S&&(S.cancel(),S.effect=null,S.onfinish=oe)},deactivate:()=>{m=oe},reset:()=>{g===0&&(E==null||E(1,0))},t:()=>C()}}class na{constructor(){this.axios=zt()}async getLogs(t,i,g){try{return[(await this.axios.get(`${Ke()}/logs/${t}`,{params:{cursor:i,filters:JSON.stringify(g)},headers:{...Gt()}})).data.data,null]}catch(m){return[null,m]}}connectToLogStream(t,i,g,m,r){let h=`${Ke()}/logs/${t}/sse?token=${ta.current.token}`;i.length>0&&(h+=`&filters=${JSON.stringify(i)}`);const p=new EventSource(h);return p.addEventListener("logs",H=>{try{const q=JSON.parse(H.data);g(q)}catch(q){console.error("Error parsing SSE log data:",q),m(q)}}),p.onerror=H=>{console.error("SSE connection error:",H),m(new Error(H.toString())),p.close(),r()},p.addEventListener("close",()=>{console.log("SSE connection closed by server"),r(),p.close()}),p.onopen=()=>{},()=>{p&&p.close()}}}const We=new na,va=a=>a;function ca(a){const t=a-1;return t*t*t+1}function Qe(a){const t=typeof a=="string"&&a.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[a,"px"]}function ua(a,{delay:t=0,duration:i=400,easing:g=va}={}){const m=+getComputedStyle(a).opacity;return{delay:t,duration:i,easing:g,css:r=>`opacity: ${r*m}`}}function fa(a,{delay:t=0,duration:i=400,easing:g=ca,x:m=0,y:r=0,opacity:h=0}={}){const p=getComputedStyle(a),H=+p.opacity,q=p.transform==="none"?"":p.transform,E=H*(1-h),[M,k]=Qe(m),[_,C]=Qe(r);return{delay:t,duration:i,easing:g,css:(S,A)=>`
			transform: ${q} translate(${(1-S)*M}${k}, ${(1-S)*_}${C});
			opacity: ${H-E*A}`}}var _a=O('<option class="svelte-1g58my7"> </option>'),da=O('<p class="filter-tip svelte-1g58my7"> </p>'),ga=O('<p class="filter-tip svelte-1g58my7"> </p>'),ma=O('<option class="svelte-1g58my7"> </option>'),pa=(a,t)=>a.key==="Enter"&&t(),ya=(a,t,i)=>s(t,i(),!0),ha=O('<button class="now-button svelte-1g58my7"> </button>'),ba=O('<input type="text" class="filter-input svelte-1g58my7"> <!>',1),wa=(a,t,i)=>s(t,i(),!0),xa=O('<button class="now-button svelte-1g58my7"> </button>'),ka=(a,t)=>a.key==="Enter"&&t(),Sa=(a,t,i)=>s(t,i(),!0),La=O('<button class="now-button svelte-1g58my7"> </button>'),$a=O('<input type="text" class="filter-input filter-input-range svelte-1g58my7"> <!> <input type="text" class="filter-input filter-input-range svelte-1g58my7"> <!>',1),qa=(a,t)=>a.key==="Enter"&&t(),Ea=O('<input type="text" class="filter-input filter-input-multi svelte-1g58my7">'),Ia=O('<div class="filter-tag svelte-1g58my7"><span class="svelte-1g58my7"> </span> <button class="remove-filter svelte-1g58my7">Ã—</button></div>'),Na=O('<div class="active-filters svelte-1g58my7"></div>'),Ta=O('<button class="reconnect-button svelte-1g58my7"> </button>'),Aa=O('<tr><td style="width: 1%;" class="svelte-1g58my7"> </td><td style="width: 1%;" class="svelte-1g58my7"> </td><td style="width: 24ch;" class="svelte-1g58my7"> </td><td style="width: 60%; word-break: break-all; text-align: left;" class="svelte-1g58my7"> </td><td style="width: 1%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" class="svelte-1g58my7"> </td></tr>'),Fa=O('<div class="loading-spinner svelte-1g58my7"></div>'),Oa=O('<p class="svelte-1g58my7">No more logs</p>'),Ca=O('<div class="page-content svelte-1g58my7"><div style="padding-bottom: 2.5rem;" class="svelte-1g58my7"></div> <div class="filter-creator svelte-1g58my7"><select class="filter-select svelte-1g58my7"></select> <!> <select class="filter-select svelte-1g58my7"></select> <!> <button class="filter-button svelte-1g58my7"> </button></div> <!> <div class="sse-status-container svelte-1g58my7"><span></span> <span class="status-text svelte-1g58my7"> </span> <!></div> <div style="flex-grow: 1; min-height: 0; max-width: 100%; overflow-y: scroll;" class="scrollbar svelte-1g58my7"><table style="max-width: 100%;" class="svelte-1g58my7"><thead class="svelte-1g58my7"><tr class="svelte-1g58my7"><th style="text-align: center;" class="svelte-1g58my7"> </th><th style="text-align: center;" class="svelte-1g58my7"><i class="fa-solid fa-signal svelte-1g58my7"></i></th><th style="text-align: center;" class="svelte-1g58my7"> </th><th style="text-align: left;" class="svelte-1g58my7"> </th><th style="text-align: center;" class="svelte-1g58my7"> </th></tr></thead><tbody class="svelte-1g58my7"><!></tbody></table> <div class="loader svelte-1g58my7"><!></div></div></div>');function Wa(a,t){Ht(t,!0);const[i,g]=ea(),m=()=>Ve(Xt,"$page",i),r=()=>Ve(aa,"$LL",i);let h=B(""),p=B(re([]));function H(){s(h,m().url.searchParams.get("model")||"",!0),s(b,[],!0),s(V,!1),s(X,0),s(W,!0),s(Z,!1),ue(),ce(),ve()}Jt(()=>{s(h,m().url.searchParams.get("model")||"",!0),Xe(()=>{H()})});const q=re([{value:"id",label:r().logs.fields.id()},{value:"created_at",label:r().logs.fields.timestamp()},{value:"category",label:r().logs.fields.category()},{value:"message",label:r().logs.fields.message()},{value:"severity",label:r().logs.fields.severity()}]),E=re([{value:"=",label:"=",requires:1},{value:"!=",label:"!=",requires:1},{value:">",label:">",requires:1},{value:">=",label:">=",requires:1},{value:"<",label:"<",requires:1},{value:"<=",label:"<=",requires:1},{value:"contains",label:r().logs.operators.contains(),requires:1},{value:"not_contains",label:r().logs.operators.not_contains(),requires:1},{value:"starts_with",label:r().logs.operators.starts_with(),requires:1},{value:"ends_with",label:r().logs.operators.ends_with(),requires:1},{value:"between",label:r().logs.operators.between(),requires:2},{value:"not_between",label:r().logs.operators.not_between(),requires:2},{value:"in",label:r().logs.operators.in(),requires:"multi"},{value:"not_in",label:r().logs.operators.not_in(),requires:"multi"}]);let M=B(re(q[0].value)),k=B(re(E[0].value)),_=B(""),C=B(""),S=B(""),A=de(()=>E.find(L=>L.value===e(k)));function G(){return je().format("DD-MM-YYYY HH:mm:ss.SSS")}function P(L){switch(L){case 1:return"trace";case 2:return"log";case 3:return"info";case 4:return"warning";case 5:return"error";case 6:return"fatal";default:return"what"}}let b=B(re([])),V=B(!1),X=B(0),W=B(!0),K=B(!1),Z=B(!1),Q=null;function et(L){s(p,e(p).filter((y,D)=>D!==L),!0),s(b,[],!0),s(X,0),s(W,!0),ve(),e(K)&&(ue(),ce())}function ne(){const L=e(M),y=e(A);if(!y)return;let D,J=!0;switch(y.requires){case 1:e(_).trim()===""?(J=!1,alert(`Please enter a value for the ${y.label} operator.`)):D=[e(_).trim()];break;case 2:e(_).trim()===""||e(C).trim()===""?(J=!1,alert(`Please enter two values for the ${y.label} operator.`)):D=[e(_).trim(),e(C).trim()];break;case"multi":e(S).trim()===""?(J=!1,alert(`Please enter comma-separated values for the ${y.label} operator.`)):(D=e(S).split(",").map(U=>U.trim()).filter(U=>U!==""),D.length===0&&(J=!1,alert(`Please enter valid comma-separated values for the ${y.label} operator.`)));break;default:J=!1,console.error("Invalid operator requirement:",y.requires)}if(J){const U={field:L,operator:y.value,value:D};s(p,[...e(p),U],!0),s(_,""),s(C,""),s(S,""),s(b,[],!0),s(X,0),s(W,!0),ve(),e(K)&&(ue(),ce())}}async function ve(){var J,U;if(e(V)||!e(W))return;const L=e(h);s(V,!0);const[y,D]=await We.getLogs(L,e(X),e(p));if(D){console.error(D),s(V,!1);return}((J=y==null?void 0:y.Logs)==null?void 0:J.length)<20&&s(W,!1),((U=y==null?void 0:y.Logs)==null?void 0:U.length)>0&&(s(b,[...e(b),...y.Logs],!0),s(X,y.Logs[y.Logs.length-1].ID,!0)),s(V,!1)}function tt(L){L.Logs&&L.Logs.length>0&&s(b,[...L.Logs.map(y=>({...y,isNew:!0})),...e(b).map(y=>({...y,isNew:!1}))],!0)}function ce(){Q&&Q(),Q=We.connectToLogStream(e(h),e(p),tt,L=>{console.error("Stream error:",L),s(K,!1),s(Z,!0)},()=>{console.log("Stream connection closed."),s(K,!1),s(Z,!0)}),s(K,!0),s(Z,!0)}function ue(){Q&&(Q(),Q=null),s(K,!1),s(b,[],!0),s(V,!1),s(X,0),s(W,!0),s(Z,!1)}let fe;Ut(()=>{const L=new IntersectionObserver(y=>{y[0].isIntersecting&&ve()},{threshold:.1});return fe&&L.observe(fe),()=>{L.disconnect(),ue()}}),Qt(a,{children:(L,y)=>{var D=Ca(),J=w(f(D),2),U=f(J);ge(U,21,()=>q,me,(l,o)=>{var v=_a(),c={},u=f(v,!0);n(v),Y(()=>{c!==(c=e(o).value)&&(v.value=(v.__value=e(o).value)==null?"":e(o).value),$(u,e(o).label)}),T(l,v)}),n(U);var Te=w(U,2);{var at=l=>{var o=da(),v=f(o,!0);n(o),Y(c=>$(v,c),[()=>r().logs.time_format_tip()]),T(l,o)},rt=(l,o)=>{{var v=c=>{var u=ga(),d=f(u,!0);n(u),Y(I=>$(d,I),[()=>r().logs.severity_tip()]),T(c,u)};z(l,c=>{e(M)==="severity"&&c(v)},o)}};z(Te,l=>{e(M)==="created_at"?l(at):l(rt,!1)})}var _e=w(Te,2);ge(_e,21,()=>E,me,(l,o)=>{var v=ma(),c={},u=f(v,!0);n(v),Y(()=>{c!==(c=e(o).value)&&(v.value=(v.__value=e(o).value)==null?"":e(o).value),$(u,e(o).label)}),T(l,v)}),n(_e);var Ae=w(_e,2);{var st=l=>{var o=ba(),v=Ie(o);pe(v),v.__keydown=[pa,ne];var c=w(v,2);{var u=d=>{var I=ha();I.__click=[ya,_,G];var j=f(I,!0);n(I),Y(N=>$(j,N),[()=>r().logs.now()]),T(d,I)};z(c,d=>{e(M)==="created_at"&&d(u)})}Y(d=>ie(v,"placeholder",d),[()=>r().logs.value()]),ye(v,()=>e(_),d=>s(_,d)),T(l,o)},lt=(l,o)=>{{var v=u=>{var d=$a(),I=Ie(d);pe(I);var j=w(I,2);{var N=x=>{var F=xa();F.__click=[wa,_,G];var ae=f(F,!0);n(F),Y(le=>$(ae,le),[()=>r().logs.now()]),T(x,F)};z(j,x=>{e(M)==="created_at"&&x(N)})}var R=w(j,2);pe(R),R.__keydown=[ka,ne];var te=w(R,2);{var se=x=>{var F=La();F.__click=[Sa,C,G];var ae=f(F,!0);n(F),Y(le=>$(ae,le),[()=>r().logs.now()]),T(x,F)};z(te,x=>{e(M)==="created_at"&&x(se)})}Y((x,F)=>{ie(I,"placeholder",x),ie(R,"placeholder",F)},[()=>r().logs.from(),()=>r().logs.to()]),ye(I,()=>e(_),x=>s(_,x)),ye(R,()=>e(C),x=>s(C,x)),T(u,d)},c=(u,d)=>{{var I=j=>{var N=Ea();pe(N),N.__keydown=[qa,ne],Y(R=>ie(N,"placeholder",R),[()=>r().logs.values_comma_separated()]),ye(N,()=>e(S),R=>s(S,R)),T(j,N)};z(u,j=>{var N;((N=e(A))==null?void 0:N.requires)==="multi"&&j(I)},d)}};z(l,u=>{var d;((d=e(A))==null?void 0:d.requires)===2?u(v):u(c,!1)},o)}};z(Ae,l=>{var o;((o=e(A))==null?void 0:o.requires)===1?l(st):l(lt,!1)})}var be=w(Ae,2);be.__click=ne;var ot=f(be,!0);n(be),n(J);var Fe=w(J,2);{var it=l=>{var o=Na();ge(o,21,()=>e(p),me,(v,c,u)=>{var d=Ia();const I=de(()=>{var x;return((x=q.find(F=>F.value===e(c).field))==null?void 0:x.label)||e(c).field}),j=de(()=>{var x;return((x=E.find(F=>F.value===e(c).operator))==null?void 0:x.label)||e(c).operator}),N=de(()=>Array.isArray(e(c).value)?e(c).value.join(", "):e(c).value);var R=f(d),te=f(R);n(R);var se=w(R,2);se.__click=()=>et(u),n(d),Y(()=>$(te,`${e(I)??""} ${e(j)??""} ${e(N)??""}`)),T(v,d)}),n(o),T(l,o)};z(Fe,l=>{e(p).length>0&&l(it)})}var we=w(Fe,2),Oe=f(we),xe=w(Oe,2),nt=f(xe,!0);n(xe);var vt=w(xe,2);{var ct=l=>{var o=Ta();o.__click=ce;var v=f(o,!0);n(o),Y((c,u)=>{ie(o,"title",c),$(v,u)},[()=>r().logs.reconnect_tip(),()=>r().logs.reconnect()]),T(l,o)};z(vt,l=>{e(Z)&&!e(K)&&l(ct)})}n(we);var Ce=w(we,2),ke=f(Ce),Se=f(ke),Me=f(Se),Le=f(Me),ut=f(Le,!0);n(Le);var $e=w(Le,2),ft=f($e,!0);n($e);var qe=w($e),_t=f(qe,!0);n(qe);var Pe=w(qe),dt=f(Pe,!0);n(Pe),n(Me),n(Se);var Re=w(Se),gt=f(Re);ra(gt,()=>[e(h),JSON.stringify(e(p))],l=>{var o=Wt(),v=Ie(o);ge(v,17,()=>e(b),me,(c,u)=>{var d=Aa(),I=f(d),j=f(I,!0);n(I);var N=w(I),R=f(N,!0);n(N);var te=w(N),se=f(te,!0);n(te);var x=w(te),F=f(x,!0);n(x);var ae=w(x),le=f(ae,!0);n(ae),n(d),Y((ht,bt,wt)=>{Ue(d,1,`row ${ht??""}`,"svelte-1g58my7"),$(j,e(u).ID),$(R,bt),$(se,wt),$(F,e(u).Message),$(le,e(u).Category)},[()=>P(e(u).Severity),()=>P(e(u).Severity).toUpperCase(),()=>je(e(u).CreatedAt).format("DD-MM-YYYY HH:mm:ss.SSS")]),Ge(1,d,()=>fa,()=>({x:-50,duration:300})),Ge(2,d,()=>ua,()=>({duration:200})),T(c,d)}),T(l,o)}),n(Re),n(ke);var Ee=w(ke,2),mt=f(Ee);{var pt=l=>{var o=Fa();T(l,o)},yt=(l,o)=>{{var v=c=>{var u=Oa();T(c,u)};z(l,c=>{e(W)||c(v)},o)}};z(mt,l=>{e(V)?l(pt):l(yt,!1)})}n(Ee),Zt(Ee,l=>fe=l,()=>fe),n(Ce),n(D),Y((l,o,v,c,u,d)=>{$(ot,l),Ue(Oe,1,`status-dot ${(e(K)?"connected":"disconnected")??""}`,"svelte-1g58my7"),$(nt,o),$(ut,v),$(ft,c),$(_t,u),$(dt,d)},[()=>r().logs.add_filter(),()=>e(K)?r().logs.live_stream_connected():r().logs.live_stream_disconnected(),()=>r().logs.fields.id(),()=>r().logs.fields.timestamp(),()=>r().logs.fields.message(),()=>r().logs.fields.category()]),Be(U,()=>e(M),l=>s(M,l)),Be(_e,()=>e(k),l=>s(k,l)),T(L,D)},$$slots:{default:!0}}),Bt(),g()}jt(["keydown","click"]);export{Wa as component};
