import"../chunks/CWj6FrbW.js";import{p as cs,a1 as H,a5 as t,x as A,g as s,a2 as P,a as ps,a3 as a,a4 as e,I as Ls,w as es,o as Cs,f as As,a6 as rs}from"../chunks/EFB-SWyS.js";import{d as _s,s as v}from"../chunks/TklIISlb.js";import{i as ls}from"../chunks/BvnGME_Q.js";import{e as os,u as J,i as is,r as T,s as Ms}from"../chunks/CZfOvoJW.js";import{t as w,a as g}from"../chunks/B0_bw6gU.js";import{b as as,a as Ss}from"../chunks/C-J09gDs.js";import{b as ds}from"../chunks/BDUMxpH1.js";import{s as Us,a as Ns}from"../chunks/CG3NMINE.js";import{g as js}from"../chunks/76V20tqp.js";import{B as qs}from"../chunks/D-TofhTc.js";import{u as ns}from"../chunks/LjJPEWw8.js";import{s as Ps}from"../chunks/Csh8CjjJ.js";import{p as vs}from"../chunks/BHtD48HF.js";import{h as G}from"../chunks/C5S46NFB.js";import{L as Bs}from"../chunks/Clak3x_s.js";var Ds=(k,l,o)=>{k.target===s(l)&&o()},Is=w('<div class="modal svelte-qp2eew" role="dialog" tabindex="-1"><div class="modal-content svelte-qp2eew"><div style="display: flex; align-items: center; justify-content: space-between;"><h2> </h2> <button class="button svelte-qp2eew" aria-label="Close"><i class="fa-solid fa-xmark fs-4"></i></button></div> <hr> <!></div></div>');function Rs(k,l){cs(l,!0);let o=H(null),B=vs(l,"children",3,null),n=vs(l,"onClose",3,null);function y(){s(o).classList.add("visible")}function u(){var m;s(o).classList.remove("visible"),(m=n())==null||m()}var i=Is();i.__mousedown=[Ds,o,u];var K=a(i),$=a(K),M=a($),O=a(M,!0);e(M);var W=t(M,2);W.__click=u,e($);var c=t($,4);return Ps(c,()=>B()??Ls),e(K),e(i),ds(i,m=>A(o,m),()=>s(o)),P(()=>v(O,l.title)),g(k,i),ps({openModal:y,closeModal:u})}_s(["mousedown","click"]);async function Vs(k,l,o,B){var u;const[n,y]=await J.createUser(s(l).username,s(l).password,s(l).display_name,s(l).is_admin);y&&console.error(y),A(o,[...s(o),n],!0),(u=s(B))==null||u.closeModal()}var zs=(k,l,o)=>l(s(o)),Es=w('<li class="card svelte-pse3s5" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div class="svelte-pse3s5"><span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> <span class="bold svelte-pse3s5"> </span></span> <br class="svelte-pse3s5"> <span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> </span> <br class="svelte-pse3s5"> <span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> </span></div> <div class="svelte-pse3s5"><button class="danger-button svelte-pse3s5"> </button></div></li>'),Fs=w('<span style="color: var(--success-color);" class="blink svelte-pse3s5"><div style="background-color: var(--success-color); padding: 0.3rem; margin: 0.1rem; border-radius: 50%; display: inline-block;" class="svelte-pse3s5"></div> </span>'),Gs=w('<span style="color: var(--error-color);" class="svelte-pse3s5"> </span>'),Hs=w('<li class="card svelte-pse3s5" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div style="display: flex; align-items: center; gap: 1rem;" class="svelte-pse3s5"><img alt="avatar" class="avatar svelte-pse3s5"> <div class="svelte-pse3s5"><span class="svelte-pse3s5"><span class="svelte-pse3s5"> </span></span> <br class="svelte-pse3s5"> <!></div></div></li>'),Js=(k,l)=>{var o;return(o=s(l))==null?void 0:o.openModal()},Ks=w('<button style="margin-top: 1rem;" class="svelte-pse3s5">Create User</button>'),Os=w('<div class="content svelte-pse3s5"><h2 class="title svelte-pse3s5"> </h2> <h3 style="" class="svelte-pse3s5"> </h3> <ul class="item-list svelte-pse3s5"></ul> <h3 style="margin-top: 2rem;" class="svelte-pse3s5"> </h3> <ul class="item-list svelte-pse3s5"></ul> <!> <div style="margin-top: 2rem;" class="svelte-pse3s5"></div></div>'),Qs=w('<div style="display: flex; flex-direction: column; gap: 1rem; width: 100%; margin-top: 1rem;" class="svelte-pse3s5"><input type="text" placeholder="Username" class="svelte-pse3s5"> <input type="text" placeholder="Display Name" class="svelte-pse3s5"> <input type="text" placeholder="Password" class="svelte-pse3s5"> <label class="svelte-pse3s5"><input type="checkbox" class="svelte-pse3s5"> <span class="svelte-pse3s5">Is Admin</span></label> <button class="svelte-pse3s5">Create User</button></div>'),Ts=w("<!> <!>",1);function _e(k,l){cs(l,!0);const[o,B]=Us(),n=()=>Ns(Bs,"$LL",o);let y=H(es([])),u=H(null),i=H(es({username:"",display_name:"",password:"",is_admin:!1}));async function K(c){if(c.is_current){if(!confirm("Are you sure you want to revoke your own session?"))return;await J.logout(),ns.current=null,js("/login");return}if(!confirm("Are you sure you want to revoke this session?"))return;const _=await J.revokeSession(c.token);_&&console.error(_),A(y,s(y).filter(p=>p.token!==c.token),!0)}Cs(async()=>{const[c,m]=await J.getActiveSessions();m&&console.error(m),A(y,c,!0);const[_,p]=await J.getAllUsers();p&&console.error(p),A($,_,!0)});let $=H(es([]));var M=Ts(),O=As(M);qs(O,{children:(c,m)=>{var _=Os(),p=a(_),D=a(p,!0);e(p);var L=t(p,2),I=a(L,!0);e(L);var S=t(L,2);os(S,21,()=>s(y),is,(x,r)=>{var d=Es(),U=a(d),N=a(U),j=a(N),V=a(j);e(j);var z=t(j),Q=t(z),Y=a(Q,!0);e(Q),e(N);var E=t(N,4),F=a(E),f=a(F);e(F);var h=t(F);e(E);var q=t(E,4),C=a(q),Z=a(C);e(C);var fs=t(C);e(q),e(U);var ts=t(U,2),ss=a(ts);ss.__click=[zs,K,r];var ys=a(ss,!0);e(ss),e(ts),e(d),P((bs,xs,hs,gs,ws,ks,$s)=>{v(V,`${bs??""}:`),v(z,` ${s(r).device??""} `),v(Y,xs),v(f,`${hs??""}:`),v(h,` ${gs??""}`),v(Z,`${ws??""}:`),v(fs,` ${ks??""}`),v(ys,$s)},[()=>n().user_sessions.my_active_sessions.device(),()=>s(r).is_current?n().user_sessions.my_active_sessions.you():"",()=>n().user_sessions.my_active_sessions.last_activity(),()=>G(s(r).last_activity).fromNow(),()=>n().user_sessions.my_active_sessions.created_at(),()=>G(s(r).created_at).fromNow(),()=>n().user_sessions.my_active_sessions.revoke()]),g(x,d)}),e(S);var R=t(S,2),b=a(R,!0);e(R);var X=t(R,2);os(X,21,()=>s($),is,(x,r)=>{var d=Hs(),U=a(d),N=a(U),j=t(N,2),V=a(j),z=a(V),Q=a(z);e(z),e(V);var Y=t(V,4);{var E=f=>{var h=Fs(),q=t(a(h));e(h),P(C=>v(q,` ${C??""}`),[()=>n().user_sessions.all_users.online()]),g(f,h)},F=f=>{var h=Gs(),q=a(h);e(h),P((C,Z)=>v(q,`${C??""}: ${Z??""}`),[()=>n().user_sessions.all_users.last_seen(),()=>G(s(r).last_activity).fromNow()]),g(f,h)};ls(Y,f=>{G(s(r).last_activity).isAfter(G().subtract(10,"second"))?f(E):f(F,!1)})}e(j),e(U),e(d),P(f=>{Ms(N,"src",`https://api.dicebear.com/9.x/thumbs/svg?seed=${s(r).username??""}`),v(Q,`${s(r).display_name??""} (@${s(r).username??""}) ${f??""}`)},[()=>s(r).is_admin?"("+n().user_sessions.all_users.admin()+")":""]),g(x,d)}),e(X);var us=t(X,2);{var ms=x=>{var r=Ks();r.__click=[Js,u],g(x,r)};ls(us,x=>{var r,d;(d=(r=ns.current)==null?void 0:r.user)!=null&&d.is_admin&&x(ms)})}rs(2),e(_),P((x,r,d)=>{v(D,x),v(I,r),v(b,d)},[()=>n().user_sessions.title(),()=>n().user_sessions.my_active_sessions.title(),()=>n().user_sessions.all_users.title()]),g(c,_)},$$slots:{default:!0}});var W=t(O,2);ds(Rs(W,{title:"Create User",onClose:()=>{A(i,{username:"",password:"",is_admin:!1},!0)},children:(c,m)=>{var _=Qs(),p=a(_);T(p);var D=t(p,2);T(D);var L=t(D,2);T(L);var I=t(L,2),S=a(I);T(S),rs(2),e(I);var R=t(I,2);R.__click=[Vs,i,$,u],e(_),as(p,()=>s(i).username,b=>s(i).username=b),as(D,()=>s(i).display_name,b=>s(i).display_name=b),as(L,()=>s(i).password,b=>s(i).password=b),Ss(S,()=>s(i).is_admin,b=>s(i).is_admin=b),g(c,_)},$$slots:{default:!0}}),c=>A(u,c,!0),()=>s(u)),g(k,M),ps(),B()}_s(["click"]);export{_e as component};
